on:
  workflow_call:
    inputs:
      java-version:
        default: 11
        required: false
        type: number
      distribution:
        default: 'temurin'
        required: false
        type: string
      pom-path:
        description: Path to pom.xml file
        default: 'app/pom.xml'
        required: false
        type: string
      maven-settings-file:
        description: Path to maven-settings.xml file, if necessary
        default: null
        required: false
        type: string

jobs:
  ci-java-maven:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
      
      - name: Setup JDK ${{ inputs.java-version }} 
        uses: actions/setup-java@v3
        with:
          java-version: ${{ inputs.java-version }}
          distribution: ${{ inputs.distribution }} 
          cache: maven # Memorizar dependÃªncias

        ##### BUILD #####
      - name: Build
        run: |
          if [[ ${{ inputs.maven-settings-file }} == null ]]; then
            echo "Running Build without Settings.xml file"
            mvn -B package --file ${{ inputs.pom-path }} -DskipTests
          else
            echo "Running Build with Settings.xml file"
            mvn -s $GITHUB_WORKSPACE/.github/workflows/${{ inputs.maven-settings-file }} -B package --file ${{ inputs.pom-path }} -DskipTests
          fi
        
        #### TESTS #####
      - name: Test
        run: |
          if [[ ${{ inputs.maven-settings-file }} == null ]]; then
            echo "Running Tests without Settings.xml file"
            mvn test --file ${{ inputs.pom-path }}
          else
            echo "Running Tests with Settings.xml file"
            mvn -s $GITHUB_WORKSPACE/.github/workflows/${{ inputs.maven-settings-file }} test --file ${{ inputs.pom-path }}
          fi
