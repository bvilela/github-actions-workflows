on:
  workflow_call:
    inputs:
      base_branch:
        description: Base branch
        default: main
        type: string
        required: false        
      title:
        description: PR Title
        default: '[Example] Simple demo'
        type: string
        required: false
      commit_message:
        description: Commit Message PR
        default: 'Simple demo'
        type: string
        required: false
      body:
        description: PR Body
        default: >
          This PR is auto-generated by 
          [create-pull-request](https://github.com/peter-evans/create-pull-request).
        type: string
        required: false
    secrets:
      token:
        description: a repo scoped Personal Access Token (PAT).
        required: true

jobs:
  open-pr-to-main:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
          
      - name: Get Current Branch Name
        shell: bash
        run: echo "branch=${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}" >> $GITHUB_OUTPUT
        id: extract_branch

      - name: Create Pull Request
        run: |
          gh pr create -B ${{ inputs.base_branch }} -H ${{ steps.extract_branch.outputs.branch }} 
          --title 'Merge ${{ steps.extract_branch.outputs.branch }} into ${{ inputs.base_branch }}'
          --body 'Created by Github action'
        env:
          GITHUB_TOKEN: ${{ secrets.token }}

      # - name: Create Pull Request
      #   uses: peter-evans/create-pull-request@v5
      #   with:
      #     token: ${{ secrets.token }}
      #     base: ${{ inputs.base_branch}}
      #     branch: ${{ steps.extract_branch.outputs.branch }}
      #     title: ${{ inputs.title }}
      #     commit-message: ${{ inputs.commit_message }}
      #     body: ${{ inputs.body }}
      #     draft: false
      #     delete-branch: false
